import os
import json

# ì„¤ì •
# ìŠ¤ìº”í•  ë£¨íŠ¸ í´ë”ë¥¼ publicìœ¼ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
ROOT_FOLDER = "public"
ICON_EXTENSIONS = [".png", ".svg", ".ico", ".jpg", ".jpeg"]
# ìƒì„±ë  íŒŒì¼ì˜ ê²½ë¡œë¥¼ src/data/ ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
OUTPUT_FILE = "src/data/iconData.ts"

def scan_icons(root_path):
    """í´ë”ë¥¼ ì¬ê·€ì ìœ¼ë¡œ ìŠ¤ìº”í•˜ì—¬ ì•„ì´ì½˜ íŒŒì¼ ì°¾ê¸°"""
    icon_data = {}
    
    # ì ˆëŒ€ ê²½ë¡œë¡œ ë³€í™˜
    abs_root_path = os.path.abspath(root_path)
    
    for dirpath, dirnames, filenames in os.walk(abs_root_path):
        # í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ìƒëŒ€ ê²½ë¡œ ê³„ì‚°
        relative_dirpath = os.path.relpath(dirpath, abs_root_path)
        # ê²½ë¡œ êµ¬ë¶„ìë¥¼ ìŠ¬ë˜ì‹œë¡œ í†µì¼
        relative_dirpath = relative_dirpath.replace(os.sep, "/")
        
        if relative_dirpath == ".":
            relative_dirpath = ""

        icons_in_folder = []
        
        for filename in filenames:
            # ì•„ì´ì½˜ í™•ì¥ì ì²´í¬
            if any(filename.lower().endswith(ext) for ext in ICON_EXTENSIONS):
                
                # íŒŒì¼ì˜ ìƒëŒ€ ê²½ë¡œ ìƒì„±
                relative_file_path = os.path.join(relative_dirpath, filename)
                relative_file_path = "/" + relative_file_path.replace(os.sep, "/")

                icons_in_folder.append({
                    "name": filename,
                    "path": relative_file_path
                })
        
        # ì•„ì´ì½˜ì´ ìˆëŠ” í´ë”ë§Œ ì¶”ê°€
        if icons_in_folder:
            folder_key = relative_dirpath
            if folder_key:
                icon_data[folder_key] = icons_in_folder
    
    return icon_data

def generate_typescript_file(icon_data, output_path):
    """TypeScript íŒŒì¼ ìƒì„±"""
    json_str = json.dumps(icon_data, indent=2, ensure_ascii=False)
    
    ts_template = '''// Auto-generated by scan.py
// ì´ íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ í¸ì§‘í•˜ì§€ ë§ˆì„¸ìš”

export interface IconItem {
  name: string;
  path: string;
}

export interface IconData {
  [folderPath: string]: IconItem[];
}

export const iconData: IconData = '''

    ts_content = ts_template + json_str + ';'
    
    # ì¶œë ¥ ë””ë ‰í† ë¦¬ ìƒì„±
    output_dir = os.path.dirname(output_path)
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)

    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(ts_content)
    
    print(f"âœ… Generated {output_path}")
    print(f"ğŸ“Š Found {len(icon_data)} folders with icons")
    total_icons = sum(len(icons) for icons in icon_data.values())
    print(f"ğŸ¨ Total icons: {total_icons}")

if __name__ == "__main__":
    print(f"ğŸ” Scanning {os.path.abspath(ROOT_FOLDER)}...")
    data = scan_icons(ROOT_FOLDER)
    generate_typescript_file(data, OUTPUT_FILE)
    print("âœ¨ Done!")